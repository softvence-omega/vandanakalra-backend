enum userRole {
    USER
    ADMIN
}

enum Status {
    JOIN
    ATTENDED
    REJECTED
}

enum AttendanceStatus {
    PRESENT
    APPCENT
}

model User {
    id                   String     @id @default(uuid())
    firstname            String
    lastname             String
    username             String     @unique
    fcmToken             String?
    image                String?
    resetPasswordToken   String? // 4-digit string like "5839"
    resetPasswordExpires DateTime?
    enrolledEvents       Enrolled[]
    isEventApproveNotify Boolean    @default(true)
    isNewEventNotify     Boolean    @default(true)
    isEventReminder      Boolean    @default(true)
    point                Int        @default(0)
    role                 userRole   @default(USER)
    password             String
    isActive             Boolean    @default(false)
    isDeleted            Boolean    @default(false)
    createdAt            DateTime   @default(now())
    updatedAt            DateTime   @updatedAt

    adminAutoApprovePoint  Boolean @default(true)
    adminAllowCustomPoint  Boolean @default(true)
    adminCreateEventNotify Boolean @default(true)
    adminEventReminders    Boolean @default(true)

    events        Event[]
    attendences   Attendence[]
    outsideEvents OutsideEvent[]
}

model Event {
    id              String     @id @default(uuid())
    title           String
    description     String?
    pointValue      Int
    date            DateTime
    time            String
    maxStudent      Int
    studentEnrolled Int        @default(0)
    createdAt       DateTime   @default(now())
    enrolled        Enrolled[]
    eventType       String     @default("INSIDE") // OUTSIDE

    user   User?   @relation(fields: [userId], references: [id])
    userId String?
}

model OutsideEvent {
    id          String    @id @default(uuid())
    title       String
    description String?
    pointValue  Int
    date        DateTime?
    createdAt   DateTime  @default(now())
    approved    Boolean   @default(false)
    user        User?     @relation(fields: [userId], references: [id])
    userId      String?
}

model Enrolled {
    id         String   @id @default(uuid())
    userId     String
    eventId    String
    claimPoint Boolean  @default(false)
    status     Status   @default(JOIN)
    user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
    event      Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)
    createdAt  DateTime @default(now())

    @@unique([userId, eventId])
}

model Attendence {
    id         String           @id @default(uuid())
    userId     String
    attendence AttendanceStatus @default(PRESENT)
    user       User             @relation(fields: [userId], references: [id], onDelete: Cascade)
    createdAt  DateTime         @default(now())
}
